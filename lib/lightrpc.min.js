!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.LightRPC=e()}(this,function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var n=function(n){function o(r,n){t(this,o);var i=e(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,r));return i.name="JSONRPCError",i.error=n,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(i,i.constructor):i.stack=new Error(r).stack,i}return r(o,Error),o}(),o=function(n){function o(r){t(this,o);var n=e(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,r));return n.name="JSONRPCNoResult","function"==typeof Error.captureStackTrace?Error.captureStackTrace(n,n.constructor):n.stack=new Error(r).stack,n}return r(o,Error),o}(),i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();var c=void 0;if("undefined"!=typeof window&&window.fetch){var u=window;c=u.fetch}else c=require("cross-fetch");return function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"string"!=typeof e)throw new Error("InvalidArgument: address has to ba a string");if("object"!==(void 0===r?"undefined":s(r)))throw new Error("InvalidArgument: defaultOptions has to be an object");this.address=e,this.options=i({timeout:5e3,headers:{"Content-Type":"application/json"}},r),this.nextRequestId=0,this.fetchURL=this.fetchURL.bind(this),this.send=this.send.bind(this)}return a(t,[{key:"fetchURL",value:function(t,e){return c(this.address,{body:JSON.stringify(t),headers:e.headers,method:"post",mode:"cors"})}},{key:"send",value:function(t,e,r,a){if("string"!=typeof t)throw new Error("InvalidArgument: method has to be a string");if(!(e instanceof Array))throw new Error("InvalidArgument: params has to be an array");if("function"!=typeof a)throw new Error("InvalidArgument: callback has to be a function");var c={id:this.nextRequestId,jsonrpc:"2.0",method:t,params:e};this.nextRequestId+=1;var u,f,h=this.options;"object"===(void 0===r?"undefined":s(r))&&(h=i({},h,r)),(u=h.timeout,f=this.fetchURL(c,h),new Promise(function(t,e){setTimeout(function(){e(new Error("Request has timed out. It should take no longer than "+u+"ms."))},u),f.then(t,e)})).then(function(t){return t.json()}).then(function(t){if(t.error)throw new n("Response contains error. See error property for details.",t.err);if(!t.result)throw new o("Response doesn't contain result");return t}).then(function(t){return a(null,t.result),t}).catch(function(t){return a(t,null)})}}]),t}()});